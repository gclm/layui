<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>authtree 无限级权限控制树 authtree - layui 第三方组件平台</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="layui 自身提供一个 tree 树形菜单，但是并不适用于权限控制中，比如：当我需要选择用户组的权限（树形结构），需要使用 form 提交用户所选权限数据的时候。">
    <link rel="stylesheet" href="../../t/font_24081_60slu02pimt.css">
    <link rel="stylesheet" href="../../layui/dist/css/layui.css">
    <link rel="stylesheet" href="../../static/css/fly/global.css">
    <link rel="stylesheet" href="../../static/css/global.css">
</head>

<body>
    <div class="layui-header header header-extends" style="background-color: #24262F;">
        <div class="layui-container">
            <a class="logo" href="../../index.html"> <img src="../../static/images/layui/logo.png" alt="layui"> </a>
            <div class="layui-form component" lay-filter="LAY-site-header-component"></div>
            <ul class="layui-nav">
                <li class="layui-nav-item layui-hide-xs"> <a href="../../index.html">框架</a> </li>
                <li class="layui-nav-item layui-hide-xs layui-this"> <a href="../index.html">扩展</a> </li>
                <li class="layui-nav-item"> <a href="javascript:;">周边</a>
                    <dl class="layui-nav-child layui-nav-child-c">
                        <dd lay-unselect=""> <a href="../../alone.html" target="_blank">独立组件</a> </dd>
                        <dd class="layui-hide-sm layui-show-xs" lay-unselect=""> <a href="../index.html">扩展组件</a>
                            <hr>
                        </dd>
                    </dl>
                </li>
                <li class="layui-nav-item"> <a href="javascript:;">专区</a>
                    <dl class="layui-nav-child layui-nav-child-c">
                        <dd lay-unselect=""> <a href="../../user/login/index.html">layuiAdmin</a>
                            <hr>
                        </dd>
                        <dd lay-unselect=""> <a href="../../user/login/index1.html" target="_blank">LayIM</a> </dd>
                    </dl>
                </li>
                <li class="layui-nav-item">
                    <a class="iconfont icon-touxiang" href="../../user/login/index2.html"></a>
                </li>
            </ul>
        </div>
    </div>
    <!--[if lt IE 9]>  <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>  <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script><![endif]-->
    <div class="fly-extend-banner fly-extend-banner-sm">
        <div class="layui-carousel" id="FLY-extend-banner" data-height="200px">
            <div carousel-item="">
                <div style="background-image: url(../../upload/2018_8/168_1535373858670_8825.jpg)">
                    <div style="background: rgba(0,0,0,.6)"></div>
                </div>
            </div>
        </div>
        <h1 class="fly-extend-banner-title">layui 第三方组件平台</h1>
        <div class="fly-extend-banner-release"> <a href="../index.html" class="layui-btn layui-btn-lg">返回首页</a> <a href="../../user/login/index3.html" class="layui-btn layui-btn-lg">发布组件</a> </div>
    </div>
    <div class="fly-extend-detail layui-card">
        <div class="layui-container">
            <div class="fly-extend-list-header">
                <h1 class="fly-extend-title layui-elip"> <a>authtree 无限级权限控制树</a> <span class="layui-badge layui-bg-green layui-hide-xs">authtree</span> </h1>
                <div class="fly-extend-list-info">
                    <a href="https://fly.layui.com/u/11634672" target="_blank" class="fly-extend-list-user" title="发布者"> <cite class="layui-hide-xs">藏锋**丨</cite> <img src="../../qqapp/101235792/905B6DB06066DB844F6F30D4E770668F/100.jpg" alt="藏锋**丨"> </a>
                </div>
            </div>
            <blockquote class="fly-extend-list-desc layui-elem-quote">
                <p>layui 自身提供一个 tree 树形菜单，但是并不适用于权限控制中，比如：当我需要选择用户组的权限（树形结构），需要使用 form 提交用户所选权限数据的时候。</p>
            </blockquote>
            <div class="fly-extend-list-bottom"> <span class="layui-inline">更新：2019-7-20 </span> <span class="layui-inline">创建：2018-8-29 </span>
                <div class="layui-btn-container layui-extend-doc-edit"> </div>
            </div>
        </div>
    </div>
    <div class="layui-container">
        <div class="layui-row layui-col-space20">
            <div class="layui-col-sm3 layui-col-md2">
                <div class="layui-card">
                    <ul class="fly-extend-doc-nav" lay-filter="extend-doc-nav">
                        <li class="layui-this" lay-id="doc"> <a href="javascript:;"><i
                                    class="iconfont icon-wendang"></i> 文档</a> </li>
                        <li lay-id="download"> <a href="javascript:;"><i class="iconfont icon-xiazai"></i> 下载</a> </li>
                        <li lay-id="">
                            <a href="https://fly.layui.com/jie/24206/" rel="nofollow" target="_blank"> <i class="iconfont icon-kaifashili"></i> 来源 </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="layui-col-sm9 layui-col-md10">
                <div class="layui-card fly-extend-doc layui-show">
                    <div class="layui-card-header">
                        <h3 class="layui-inline layui-this">文档</h3>
                    </div>
                    <div class="layui-card-body detail-body photos layui-text">
                        layui自身提供一个tree树形菜单，但是并不适用于权限控制中，比如：选择用户组的权限（树形结构），需要使用form提交用户所选权限数据。<br>项目中遇到了此类需求，所以特意封装了一个扩展用于渲染此类操作。<br>github:
                        <a href="https://github.com/wangerzi/layui-authtree" target="_blank" rel="nofollow">https://github.com/wangerzi/layui-authtree</a> <br>
                        <div class="layui-elem-quote"> 特别注意：权限树的渲染目标需要在 .layui-form .layui-item下，否则将无法渲染出样式。</div>
                        <div class="layui-elem-quote">环境提示：预览环境需要部署在服务器下，不然无法异步获取权限树的数据</div>
                        <div class="layui-elem-quote">版本更新提示：v0.3 将inputname(表单名)、layfilter(lay-filter属性)和新增的openall(默认展开全部)配置更正为以对象的形式传递，覆盖更新后请注意此变化。
                        </div>
                        <hr>
                        <div class="layui-elem-quote">功能演示：</div><img src="https://raw.githubusercontent.com/wangerzi/layui-authtree/master/screenGIF.gif"> <br>
                        <div class="layui-elem-quote">在线演示</div>最新插件演示地址：<br> <a href="http://authtree.wj2015.com/" target="_blank" rel="nofollow">http://authtree.wj2015.com/</a> <br><br>
                        <div class="layui-elem-quote">沟通交流</div>QQ群号：789188686<br><img src="https://raw.githubusercontent.com/wangerzi/layui-authtree/master/qq_group_qrcode.png">
                        <br><br>
                        <div class="layui-elem-quote">社区期望收集</div>如果您有好的建议或者想法，可以回帖或者发送到我的邮箱( admin@<a href="javascript:;" class="fly-aite">wj2015.com</a> )，如果建议合适，我将收集于此便于以后更新。<br><img src="../../upload/2018_11/11634672_1542620829467_98911.png"> <br>
                        <hr>
                        <div class="layui-elem-quote">快速上手</div>
                        由于插件规模扩大和功能的增加，导致插件上手难度有一定的增加。但如果只使用核心功能，其实没有必要去研究插件的所有方法，故在此把此插件解决核心需求的方法展示出来。<br><img src="../../upload/2018_10/11634672_1539135295019_98915.png"> <br>
                        <pre>&lt;form class=&quot;layui-form&quot;&gt;<br>    &lt;div class=&quot;layui-form-item&quot;&gt;<br>        &lt;label class=&quot;layui-form-label&quot;&gt;角色名称&lt;/label&gt;<br>        &lt;div class=&quot;layui-input-block&quot;&gt;<br>            &lt;input class=&quot;layui-input&quot; type=&quot;text&quot; name=&quot;name&quot; placeholder=&quot;请输入角色名称&quot; /&gt;<br>        &lt;/div&gt;<br>    &lt;/div&gt;<br>    &lt;div class=&quot;layui-form-item&quot;&gt;<br>        &lt;label class=&quot;layui-form-label&quot;&gt;选择权限&lt;/label&gt;<br>        &lt;div class=&quot;layui-input-block&quot;&gt;<br>            &lt;div id=&quot;LAY-auth-tree-index&quot;&gt;&lt;/div&gt;<br>        &lt;/div&gt;<br>    &lt;/div&gt;<br>    &lt;div class=&quot;layui-form-item&quot;&gt;<br>        &lt;div class=&quot;layui-input-block&quot;&gt;<br>            &lt;button class=&quot;layui-btn&quot; type=&quot;submit&quot; lay-submit lay-filter=&quot;LAY-auth-tree-submit&quot;&gt;提交&lt;/button&gt;<br>            &lt;button class=&quot;layui-btn layui-btn-primary&quot; type=&quot;reset&quot;&gt;重置&lt;/button&gt;<br>        &lt;/div&gt;<br>    &lt;/div&gt;<br>&lt;/form&gt;</pre>
                        <img src="../../upload/2018_10/11634672_1539135373548_55768.png"> <br>
                        <pre>layui.config({<br>	base: &#39;extends/&#39;,<br>}).extend({<br>	authtree: &#39;authtree&#39;,<br>});</pre>
                        <img src="../../upload/2018_10/11634672_1539135426287_85043.png"> <br>
                        <pre>layui.use([&#39;jquery&#39;, &#39;authtree&#39;, &#39;form&#39;, &#39;layer&#39;], function(){<br>	var $ = layui.jquery;<br>	var authtree = layui.authtree;<br>	var form = layui.form;<br>	var layer = layui.layer;<br>	// 一般来说，权限数据是异步传递过来的<br>	$.ajax({<br>		url: &#39;tree.json&#39;,<br>		dataType: &#39;json&#39;,<br>		success: function(data){<br>            var trees = data.data.trees;<br>            // 如果后台返回的不是树结构，请使用 authtree.listConvert 转换<br>            authtree.render(&#39;#LAY-auth-tree-index&#39;, trees, {<br>				inputname: &#39;authids[]&#39;, <br>				layfilter: &#39;lay-check-auth&#39;, <br>				autowidth: true,<br>			});<br>        }<br>    });<br>});</pre>                        至此，一个最基础的权限树就已经完成了，如果想实现演示GIF内的各种扩展功能，请继续往下看，并参考源码
                        <br>
                        <hr>
                        <div class="layui-elem-quote">数据库设计和后台程序参考</div>正在完善中....<br><br>
                        <div class="layui-elem-quote">函数列表</div><img src="../../upload/2018_11/11634672_1542620889456_10271.png"> <br><br>
                        <div class="layui-elem-quote">参数配置：</div>render 参数配置<br>render()函数是本插件的核心方法，调用 `render(dst, trees, opt)` 函数时，opt 中可以传递的参数如下<br><img src="../../upload/2018_11/11634672_1542621271281_49778.png"> <br><br>
                        <div class="layui-elem-quote"> **自动选中父级节点和自动取消父级选中 用法描述：**
                            <br><br>自动选中父级节点：开启后，选中某节点，会将其上层所有未选中父节点设为选中，并且将其下层所有节点设为选中；取消选中某节点，其所有子节点均取消。<br>自动取消父级节点：开启后，取消选中某一子节点，当其兄弟节点均处于未选中状态，自动取消父级节点<br><br>两种状态一般同时开启，或者同时关闭，不然可能体验有点奇怪
                        </div> treeConvertSelect参数配置<br>`treeConverSelect` 是用于树转换为『单选树』的方法，其中 opt 参数如下<br><img src="../../upload/2018_11/11634672_1542620975403_22893.png"> <br><br>listConvert 参数配置
                        <br>listConvert 是用于转换列表和树结构的方法，参数比较灵活，调用 `listConvert(list, opt)` 时，opt可传入参数如下<br><img src="../../upload/2018_10/11634672_1539135878447_32675.png"> <br><img src="../../upload/2018_10/11634672_1539135920787_87356.png"> <br><br>
                        <div class="layui-elem-quote">后台编辑权限API代码示例（PHP）</div>
                        <pre>&lt;?php<br>$role_id = $_GET[&#39;role_id&#39;];<br>$auth_list = .....;// 获取数据库中 权限表数据<br>$role_auth_list = ....;// 获取数据库中某个角色的 角色-权限表数据<br><br>$data = [<br>    &#39;code&#39; =&gt; 0,<br>    &#39;msg&#39;  =&gt; &#39;获取成功&#39;,<br>    &#39;data&#39; =&gt; [<br>        &#39;list&#39; =&gt; $auth_list,<br>        &#39;checkedId&#39; =&gt; array_column($role_auth_list, &#39;authid&#39;),<br>    ],<br>];<br>echo json_encode($data);</pre>
                        <div class="layui-elem-quote">API返回数据示例</div>
                        <pre>{<br>  &quot;code&quot;: 0,<br>  &quot;msg&quot;: &quot;获取成功&quot;,<br>  &quot;data&quot;: {<br>    &quot;list&quot;: [<br>      { &quot;id&quot;: 1, &quot;name&quot;: &quot;用户管理&quot;, &quot;pid&quot;: 0 },<br>      { &quot;id&quot;: 2, &quot;name&quot;: &quot;用户组管理&quot;, &quot;pid&quot;: 0 },<br>      { &quot;id&quot;: 3, &quot;name&quot;: &quot;角色管理&quot;, &quot;pid&quot;: 2 },<br>      { &quot;id&quot;: 4, &quot;name&quot;: &quot;添加角色&quot;, &quot;pid&quot;:  3},<br>      { &quot;id&quot;: 5, &quot;name&quot;: &quot;角色列表&quot;, &quot;pid&quot;: 3 },<br>      { &quot;id&quot;: 6, &quot;name&quot;: &quot;管理员管理&quot;, &quot;pid&quot;: 0 },<br>      { &quot;id&quot;: 7, &quot;name&quot;: &quot;添加管理员&quot;, &quot;pid&quot;: 6 },<br>      { &quot;id&quot;: 8, &quot;name&quot;: &quot;管理员列表&quot;, &quot;pid&quot;: 6 }<br>    ],<br>    &quot;checkedId&quot;: [ 1,  2, 3, 4 ]<br>  }<br>}</pre>
                        <div class="layui-elem-quote">列表转树前端使用样例</div>这里注意 `startPid` 参数的数据类型需要和列表返回的一致，`id` 和 `pid` 的数据类型需一致，如果列表返回的id数据均为字符串，则 startPid 应该为 `&#39;0&#39;`<br>
                        <pre>var trees = authtree.listConvert(res.data.list, {<br>    primaryKey: &#39;id&#39;<br>    ,startPid: 0<br>    ,parentKey: &#39;pid&#39;<br>    ,nameKey: &#39;name&#39;<br>    ,valueKey: &#39;id&#39;<br>    ,checkedKey: res.data.checkedId<br>});</pre>
                        <div class="layui-elem-quote">监听事件：</div><img src="../../upload/2018_9/11634672_1537689529490_85318.jpg"> <br>
                        <div class="layui-elem-quote">功能概览：</div>1. 支持无限级渲染结构树<br>2. 点击深层次节点，父级节点中没有被选中的节点会被自动选中<br>3. 单独点击父节点，子节点会全部 选中/去选中<br>4. 支持默认选中（适用于编辑权限）<br>5. 支持自定义表单名称（上传数据的name）<br>6. 支持自定义lay-filter用于监听权限树选中(v0.2新增)
                        <br>7. 支持获取选中叶子结点信息(v0.2新增)<br>8. 自适应标签名字长度配置(v0.5新增)<br>9. 支持各种方式花样获取数据（v1.0 新增，具体参考函数表）<br>10. 支持普通列表转树(v1.1 支持)<br>11. 支持自动展开所有选中节点(v1.1 支持)<br>12. 支持列表转树(v1.1 支持)<br>13. 支持双击展开子节点(v1.1 支持)<br>14. 支持配置渲染参数、单选树、下拉树(v1.2 支持)<br>
                        <hr>
                        <div class="layui-elem-quote"> 更新记录：</div>2018-11-19 v1.2 支持单选树、下拉树、展开/收起图标配置<br>2018-09-23 v1.1 新增自动展开所有选中节点,列表转树,支持双击展开子节点等方法,消除BUG
                        <br>2018-09-23 v1.0 正式版，方法效率优化以及新增监听事件，消除各种BUG<br>2018-09-19 v1.0 完善权限树的方法，新增方法请见函数列表和演示样例<br>2018-05-03 v0.4 新增获取全部数据、全部已选数据、全部未选数据方法，修复编码问题。<br>2018-05-03 v.03 新增默认展开全部的配置项(openall)，并将部分配置项作为可选参数通过对象传递。<br>2018-03-30 v0.2 修复一级菜单没有子菜单时显示错位的问题，支持获取叶子结点数据，支持自定义lay-filter
                        <br>2018-03-24 v0.1 最初版本<br>
                        <hr>
                        <div class="layui-elem-quote">测试用权限树结构(tree.json)：</div>
                        <pre>{<br>  &quot;code&quot;: 0,<br>  &quot;msg&quot;: &quot;获取成功&quot;,<br>  &quot;data&quot;: {<br>    &quot;trees&quot;:[<br>    	{&quot;name&quot;: &quot;用户管理&quot;, &quot;value&quot;: &quot;xsgl&quot;, &quot;checked&quot;: true, &quot;list&quot;: [<br>    		{&quot;name&quot;: &quot;用户组&quot;, &quot;value&quot;: &quot;xsgl-basic&quot;, &quot;checked&quot;: true, &quot;list&quot;: [<br>    			{&quot;name&quot;: &quot;本站用户&quot;, &quot;value&quot;: &quot;xsgl-basic-xsxm&quot;, &quot;checked&quot;: true, &quot;list&quot;: [<br>    				{&quot;name&quot;: &quot;用户列表&quot;, &quot;value&quot;: &quot;xsgl-basic-xsxm-readonly&quot;, &quot;checked&quot;: true},<br>    				{&quot;name&quot;: &quot;新增用户&quot;, &quot;value&quot;: &quot;xsgl-basic-xsxm-editable&quot;, &quot;checked&quot;: false}<br>    			]},<br>                {&quot;name&quot;: &quot;第三方用户&quot;, &quot;value&quot;: &quot;xsgl-basic-xsxm&quot;, &quot;checked&quot;: true, &quot;list&quot;: [<br>                    {&quot;name&quot;: &quot;用户列表&quot;, &quot;value&quot;: &quot;xsgl-basic-xsxm-readonly&quot;, &quot;checked&quot;: true}<br>                ]}<br>    		]}<br>    	]},<br>    	{&quot;name&quot;: &quot;用户组管理&quot;, &quot;value&quot;: &quot;sbgl&quot;, &quot;checked&quot;: true, &quot;list&quot;: [<br>    		{&quot;name&quot;: &quot;角色管理&quot;, &quot;value&quot;: &quot;sbgl-sbsjlb&quot;, &quot;checked&quot;: true, &quot;list&quot;:[<br>    			{&quot;name&quot;: &quot;添加角色&quot;, &quot;value&quot;: &quot;sbgl-sbsjlb-dj&quot;, &quot;checked&quot;: true},<br>    			{&quot;name&quot;: &quot;角色列表&quot;, &quot;value&quot;: &quot;sbgl-sbsjlb-yl&quot;, &quot;checked&quot;: false}<br>    		]},<br>            {&quot;name&quot;: &quot;管理员管理&quot;, &quot;value&quot;: &quot;sbgl-sbsjlb&quot;, &quot;checked&quot;: true, &quot;list&quot;:[<br>                {&quot;name&quot;: &quot;添加管理员&quot;, &quot;value&quot;: &quot;sbgl-sbsjlb-dj&quot;, &quot;checked&quot;: true},<br>                {&quot;name&quot;: &quot;管理员列表&quot;, &quot;value&quot;: &quot;sbgl-sbsjlb-yl&quot;, &quot;checked&quot;: false}<br>            ]}<br>    	]}<br>    ]<br>  }<br>}</pre>
                        <div class="layui-elem-quote">测试用列表转树结构(list.json)：</div>
                        <pre>{<br>  &quot;code&quot;: 0,<br>  &quot;msg&quot;: &quot;获取成功&quot;,<br>  &quot;data&quot;: {<br>    &quot;list&quot;: [<br>      { &quot;id&quot;: 1, &quot;name&quot;: &quot;用户管理&quot;, &quot;alias&quot;: &quot;yhgl&quot;, &quot;palias&quot;: &quot;0&quot; },<br>      { &quot;id&quot;: 2, &quot;name&quot;: &quot;用户组管理&quot;, &quot;alias&quot;: &quot;yhzgl&quot;, &quot;palias&quot;: &quot;0&quot; },<br>      { &quot;id&quot;: 3, &quot;name&quot;: &quot;角色管理&quot;, &quot;alias&quot;: &quot;yhzgl-jsgl&quot;, &quot;palias&quot;: &quot;yhzgl&quot; },<br>      { &quot;id&quot;: 4, &quot;name&quot;: &quot;添加角色&quot;, &quot;alias&quot;: &quot;yhzgl-jsgl-tjjs&quot;, &quot;palias&quot;: &quot;yhzgl-jsgl&quot; },<br>      { &quot;id&quot;: 5, &quot;name&quot;: &quot;角色列表&quot;, &quot;alias&quot;: &quot;yhzgl-jsgl-jslb&quot;, &quot;palias&quot;: &quot;yhzgl-jsgl&quot; },<br>      { &quot;id&quot;: 6, &quot;name&quot;: &quot;管理员管理&quot;, &quot;alias&quot;: &quot;glygl&quot;, &quot;palias&quot;: &quot;0&quot; },<br>      { &quot;id&quot;: 7, &quot;name&quot;: &quot;添加管理员&quot;, &quot;alias&quot;: &quot;glygl-tjgly&quot;, &quot;palias&quot;: &quot;glygl&quot; },<br>      { &quot;id&quot;: 8, &quot;name&quot;: &quot;管理员列表&quot;, &quot;alias&quot;: &quot;glygl-glylb&quot;, &quot;palias&quot;: &quot;glygl&quot; }<br>    ],<br>    &quot;checkedAlias&quot;: [ &quot;yhgl&quot;,  &quot;yhzgl&quot;, &quot;yhzgl-jsgl&quot;, &quot;yhzgl-jsgl-tjjs&quot; ]<br>  }<br>}</pre>
                        <div class="layui-elem-quote">测试用列表转树结构（list-2.json）</div>
                        <pre>{<br>  &quot;code&quot;: 0,<br>  &quot;msg&quot;: &quot;获取成功&quot;,<br>  &quot;data&quot;: {<br>    &quot;list&quot;: [<br>      { &quot;id&quot;: 1, &quot;name&quot;: &quot;用户管理&quot;, &quot;pid&quot;: 0 },<br>      { &quot;id&quot;: 2, &quot;name&quot;: &quot;用户组管理&quot;, &quot;pid&quot;: 0 },<br>      { &quot;id&quot;: 3, &quot;name&quot;: &quot;角色管理&quot;, &quot;pid&quot;: 2 },<br>      { &quot;id&quot;: 4, &quot;name&quot;: &quot;添加角色&quot;, &quot;pid&quot;:  3},<br>      { &quot;id&quot;: 5, &quot;name&quot;: &quot;角色列表&quot;, &quot;pid&quot;: 3 },<br>      { &quot;id&quot;: 6, &quot;name&quot;: &quot;管理员管理&quot;, &quot;pid&quot;: 0 },<br>      { &quot;id&quot;: 7, &quot;name&quot;: &quot;添加管理员&quot;, &quot;pid&quot;: 6 },<br>      { &quot;id&quot;: 8, &quot;name&quot;: &quot;管理员列表&quot;, &quot;pid&quot;: 6 }<br>    ],<br>    &quot;checkedId&quot;: [ 1,  2, 3, 4 ]<br>  }<br>}</pre>
                        <div class="layui-elem-quote">authtree.js</div>由于插件规模的扩大，不适合直接放在帖子内，请移步 GITHUB 下载，地址： <a href="https://github.com/wangerzi/layui-authtree" target="_blank" rel="nofollow">https://github.com/wangerzi/layui-authtree</a> <br>
                        <hr>
                        <div class="layui-elem-quote">调用样例(index.html)：</div>
                        <pre>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>	&lt;meta charset=&quot;utf-8&quot;&gt;<br>	&lt;title&gt;权限树扩展分享&lt;/title&gt;<br>	&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;layui/css/layui.css&quot;&gt;<br>	&lt;script type=&quot;text/javascript&quot; src=&quot;layui/layui.js&quot;&gt;&lt;/script&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;div class=&quot;layui-container&quot;&gt;<br>	&lt;div class=&quot;layui-row&quot;&gt;<br>		&lt;div class=&quot;layui-col-md11 layui-col-md-offset1&quot;&gt;<br>			&lt;fieldset class=&quot;layui-elem-field layui-field-title&quot;&gt;&lt;legend&gt;权限树操作演示&lt;/legend&gt;&lt;/fieldset&gt;<br>			&lt;div class=&quot;layui-form&quot;&gt;<br>				&lt;div class=&quot;layui-form-item&quot;&gt;<br>					&lt;div class=&quot;layui-form-label&quot;&gt;普通操作&lt;/div&gt;<br>					&lt;div class=&quot;layui-form-block&quot;&gt;<br>						&lt;button type=&quot;button&quot; class=&quot;layui-btn layui-btn-primary&quot; onclick=&quot;getMaxDept(&#39;#LAY-auth-tree-index&#39;)&quot;&gt;获取树的深度&lt;/button&gt;<br>						&lt;button type=&quot;button&quot; class=&quot;layui-btn layui-btn-primary&quot; onclick=&quot;checkAll(&#39;#LAY-auth-tree-index&#39;)&quot;&gt;全选&lt;/button&gt;<br>						&lt;button type=&quot;button&quot; class=&quot;layui-btn layui-btn-primary&quot; onclick=&quot;uncheckAll(&#39;#LAY-auth-tree-index&#39;)&quot;&gt;全不选&lt;/button&gt;<br>						&lt;button type=&quot;button&quot; class=&quot;layui-btn layui-btn-primary&quot; onclick=&quot;showAll(&#39;#LAY-auth-tree-index&#39;)&quot;&gt;全部展开&lt;/button&gt;<br>						&lt;button type=&quot;button&quot; class=&quot;layui-btn layui-btn-primary&quot; onclick=&quot;closeAll(&#39;#LAY-auth-tree-index&#39;)&quot;&gt;全部隐藏&lt;/button&gt;<br>						&lt;button type=&quot;button&quot; class=&quot;layui-btn layui-btn-primary&quot; onclick=&quot;getNodeStatus(&#39;#LAY-auth-tree-index&#39;)&quot;&gt;获取节点状态&lt;/button&gt;<br>					&lt;/div&gt;<br>				&lt;/div&gt;<br>				&lt;div class=&quot;layui-form-item&quot;&gt;<br>					&lt;div class=&quot;layui-form-label&quot;&gt;特殊操作&lt;/div&gt;<br>					&lt;div class=&quot;layui-form-block&quot;&gt;<br>						&lt;button type=&quot;button&quot; class=&quot;layui-btn layui-btn-primary&quot; onclick=&quot;showDept(&#39;#LAY-auth-tree-index&#39;)&quot;&gt;展开到某层&lt;/button&gt;<br>						&lt;button type=&quot;button&quot; class=&quot;layui-btn layui-btn-primary&quot; onclick=&quot;closeDept(&#39;#LAY-auth-tree-index&#39;)&quot;&gt;关闭某层后所有的层&lt;/button&gt;<br>						&lt;button type=&quot;button&quot; class=&quot;layui-btn layui-btn-primary&quot; onclick=&quot;listConvert(&#39;list.json&#39;)&quot;&gt;列表转树&lt;/button&gt;<br>					&lt;/div&gt;<br>				&lt;/div&gt;<br>			&lt;/div&gt;<br>		&lt;/div&gt;<br>		&lt;div class=&quot;layui-col-md6 layui-col-md-offset1&quot;&gt;<br>			&lt;fieldset class=&quot;layui-elem-field layui-field-title&quot;&gt;&lt;legend&gt;权限树扩展分享&lt;/legend&gt;&lt;/fieldset&gt;<br>			&lt;!-- 此扩展能递归渲染一个权限树，点击深层次节点，父级节点中没有被选中的节点会被自动选中，单独点击父节点，子节点会全部 选中/去选中 --&gt;<br>			&lt;form class=&quot;layui-form&quot;&gt;<br>				&lt;div class=&quot;layui-form-item&quot;&gt;<br>					&lt;label class=&quot;layui-form-label&quot;&gt;角色名称&lt;/label&gt;<br>					&lt;div class=&quot;layui-input-block&quot;&gt;<br>						&lt;input class=&quot;layui-input&quot; type=&quot;text&quot; name=&quot;name&quot; placeholder=&quot;请输入角色名称&quot; /&gt;<br>					&lt;/div&gt;<br>				&lt;/div&gt;<br>				&lt;div class=&quot;layui-form-item&quot;&gt;<br>					&lt;label class=&quot;layui-form-label&quot;&gt;选择权限&lt;/label&gt;<br>					&lt;div class=&quot;layui-input-block&quot;&gt;<br>						&lt;div id=&quot;LAY-auth-tree-index&quot;&gt;&lt;/div&gt;<br>					&lt;/div&gt;<br>				&lt;/div&gt;<br>				&lt;div class=&quot;layui-form-item&quot;&gt;<br>					&lt;div class=&quot;layui-input-block&quot;&gt;<br>						&lt;button class=&quot;layui-btn&quot; type=&quot;submit&quot; lay-submit lay-filter=&quot;LAY-auth-tree-submit&quot;&gt;提交&lt;/button&gt;<br>						&lt;button class=&quot;layui-btn layui-btn-primary&quot; type=&quot;reset&quot;&gt;重置&lt;/button&gt;<br>					&lt;/div&gt;<br>				&lt;/div&gt;<br>			&lt;/form&gt;<br>		&lt;/div&gt;<br>	&lt;/div&gt;<br>&lt;/div&gt;<br>&lt;/body&gt;<br>&lt;script type=&quot;text/javascript&quot;&gt;<br>layui.config({<br>	base: &#39;extends/&#39;,<br>}).extend({<br>	authtree: &#39;authtree&#39;,<br>});<br>layui.use([&#39;jquery&#39;, &#39;authtree&#39;, &#39;form&#39;, &#39;layer&#39;], function(){<br>	var $ = layui.jquery;<br>	var authtree = layui.authtree;<br>	var form = layui.form;<br>	var layer = layui.layer;<br>	// 初始化<br>	$.ajax({<br>		url: &#39;tree.json&#39;,<br>		dataType: &#39;json&#39;,<br>		success: function(data){<br>			// 渲染时传入渲染目标ID，树形结构数据（具体结构看样例，checked表示默认选中），以及input表单的名字<br>			authtree.render(&#39;#LAY-auth-tree-index&#39;, data.data.trees, {<br>				inputname: &#39;authids[]&#39;<br>				,layfilter: &#39;lay-check-auth&#39;<br>				// ,autoclose: false<br>				// ,autochecked: false<br>				// ,openchecked: true<br>				// ,openall: true<br>				,autowidth: true<br>			});<br><br>			// PS:使用 form.on() 会引起了事件冒泡延迟的BUG，需要 setTimeout()，并且无法监听全选/全不选<br>			// PS:如果开启双击展开配置，form.on()会记录两次点击事件，authtree.on()不会<br>			form.on(&#39;checkbox(lay-check-auth)&#39;, function(data){<br>				// 注意这里：需要等待事件冒泡完成，不然获取叶子节点不准确。<br>				setTimeout(function(){<br>					console.log(&#39;监听 form 触发事件数据&#39;, data);<br>					// 获取选中的叶子节点<br>					var leaf = authtree.getLeaf(&#39;#LAY-auth-tree-index&#39;);<br>					console.log(&#39;leaf&#39;, leaf);<br>					// 获取最新选中<br>					var lastChecked = authtree.getLastChecked(&#39;#LAY-auth-tree-index&#39;);<br>					console.log(&#39;lastChecked&#39;, lastChecked);<br>					// 获取最新取消<br>					var lastNotChecked = authtree.getLastNotChecked(&#39;#LAY-auth-tree-index&#39;);<br>					console.log(&#39;lastNotChecked&#39;, lastNotChecked);<br>				}, 100);<br>			});<br>			// 使用 authtree.on() 不会有冒泡延迟<br>			authtree.on(&#39;change(lay-check-auth)&#39;, function(data) {<br>				console.log(&#39;监听 authtree 触发事件数据&#39;, data);<br>				// 获取所有节点<br>				var all = authtree.getAll(&#39;#LAY-auth-tree-index&#39;);<br>				console.log(&#39;all&#39;, all);<br>				// 获取所有已选中节点<br>				var checked = authtree.getChecked(&#39;#LAY-auth-tree-index&#39;);<br>				console.log(&#39;checked&#39;, checked);<br>				// 获取所有未选中节点<br>				var notchecked = authtree.getNotChecked(&#39;#LAY-auth-tree-index&#39;);<br>				console.log(&#39;notchecked&#39;, notchecked);<br>				// 获取选中的叶子节点<br>				var leaf = authtree.getLeaf(&#39;#LAY-auth-tree-index&#39;);<br>				console.log(&#39;leaf&#39;, leaf);<br>				// 获取最新选中<br>				var lastChecked = authtree.getLastChecked(&#39;#LAY-auth-tree-index&#39;);<br>				console.log(&#39;lastChecked&#39;, lastChecked);<br>				// 获取最新取消<br>				var lastNotChecked = authtree.getLastNotChecked(&#39;#LAY-auth-tree-index&#39;);<br>				console.log(&#39;lastNotChecked&#39;, lastNotChecked);<br>			});<br>			authtree.on(&#39;deptChange(lay-check-auth)&#39;, function(data) {<br>				console.log(&#39;监听到显示层数改变&#39;,data);<br>			});<br>		}<br>	});<br>	form.on(&#39;submit(LAY-auth-tree-submit)&#39;, function(obj){<br>		var authids = authtree.getAll(&#39;#LAY-auth-tree-index&#39;);<br>		console.log(&#39;Choosed authids is&#39;, authids);<br>		obj.field.authids = authids;<br>		$.ajax({<br>			url: &#39;tree.json&#39;,<br>			dataType: &#39;json&#39;,<br>			data: obj.field,<br>			success: function(res){<br>				layer.alert(&#39;提交成功！&#39;);<br>			}<br>		});<br>		return false;<br>	});<br>});<br>&lt;/script&gt;<br>&lt;script type=&quot;text/javascript&quot;&gt;<br>// 获取最大深度样例<br>function getMaxDept(dst){<br>	layui.use([&#39;jquery&#39;, &#39;layer&#39;, &#39;authtree&#39;], function(){<br>		var layer = layui.layer;<br>		var authtree = layui.authtree;<br><br>		layer.alert(&#39;树&#39;+dst+&#39;的最大深度为：&#39;+authtree.getMaxDept(dst));<br>	});<br>}<br>// 全选样例<br>function checkAll(dst){<br>	layui.use([&#39;jquery&#39;, &#39;layer&#39;, &#39;authtree&#39;], function(){<br>		var layer = layui.layer;<br>		var authtree = layui.authtree;<br><br>		authtree.checkAll(dst);<br>	});<br>}<br>// 全不选样例<br>function uncheckAll(dst){<br>	layui.use([&#39;jquery&#39;, &#39;layer&#39;, &#39;authtree&#39;], function(){<br>		var layer = layui.layer;<br>		var authtree = layui.authtree;<br><br>		authtree.uncheckAll(dst);<br>	});<br>}<br>// 显示全部<br>function showAll(dst){<br>	layui.use([&#39;jquery&#39;, &#39;layer&#39;, &#39;authtree&#39;], function(){<br>		var layer = layui.layer;<br>		var authtree = layui.authtree;<br><br>		authtree.showAll(dst);<br>	});<br>}<br>// 隐藏全部<br>function closeAll(dst){<br>	layui.use([&#39;jquery&#39;, &#39;layer&#39;, &#39;authtree&#39;], function(){<br>		var layer = layui.layer;<br>		var authtree = layui.authtree;<br><br>		authtree.closeAll(dst);<br>	});<br>}<br>// 获取节点状态<br>function getNodeStatus(dst){<br>	layui.use([&#39;jquery&#39;, &#39;layer&#39;, &#39;authtree&#39;, &#39;laytpl&#39;], function(){<br>		var layer = layui.layer;<br>		var authtree = layui.authtree;<br>		var laytpl = layui.laytpl;<br><br>		// 获取所有节点<br>		var all = authtree.getAll(&#39;#LAY-auth-tree-index&#39;);<br>		// 获取所有已选中节点<br>		var checked = authtree.getChecked(&#39;#LAY-auth-tree-index&#39;);<br>		// 获取所有未选中节点<br>		var notchecked = authtree.getNotChecked(&#39;#LAY-auth-tree-index&#39;);<br>		// 获取选中的叶子节点<br>		var leaf = authtree.getLeaf(&#39;#LAY-auth-tree-index&#39;);<br>		// 获取最新选中<br>		var lastChecked = authtree.getLastChecked(&#39;#LAY-auth-tree-index&#39;);<br>		// 获取最新取消<br>		var lastNotChecked = authtree.getLastNotChecked(&#39;#LAY-auth-tree-index&#39;);<br><br>		var data = [<br>			{func: &#39;getAll&#39;, desc: &#39;获取所有节点&#39;, data: all},<br>			{func: &#39;getChecked&#39;, desc: &#39;获取所有已选中节点&#39;, data: checked},<br>			{func: &#39;getNotChecked&#39;, desc: &#39;获取所有未选中节点&#39;, data: notchecked},<br>			{func: &#39;getLeaf&#39;, desc: &#39;获取选中的叶子节点&#39;, data: leaf},<br>			{func: &#39;getLastChecked&#39;, desc: &#39;获取最新选中&#39;, data: lastChecked},<br>			{func: &#39;getLastNotChecked&#39;, desc: &#39;获取最新取消&#39;, data: lastNotChecked},<br>		];<br><br>		var string =  laytpl($(&#39;#LAY-auth-tree-nodes&#39;).html()).render({<br>			data: data,<br>		});<br>		layer.open({<br>			title: &#39;节点状态&#39;<br>			,content: string<br>			,area: &#39;800px&#39;<br>			,tipsMore: true<br>		});<br>		$(&#39;body&#39;).unbind(&#39;click&#39;).on(&#39;click&#39;, &#39;.LAY-auth-tree-show-detail&#39;, function(){<br>			layer.open({<br>				type: 1,<br>				title: $(this).data(&#39;title&#39;)+&#39;-节点详情&#39;,<br>				content: &#39;[&#39;+$(this).data(&#39;content&#39;)+&#39;]&#39;,<br>				tipsMore: true<br>			});<br>		});<br>	});<br>}<br>// 显示到某层<br>function showDept(dst) {<br>	layui.use([&#39;layer&#39;, &#39;authtree&#39;, &#39;jquery&#39;], function(){<br>		var jquery = layui.jquery;<br>		var layer = layui.layer;<br>		var authtree = layui.authtree;<br><br>		layer.prompt({title: &#39;显示到某层&#39;}, function(value, index, elem) {<br>			authtree.showDept(dst, value);<br>			layer.close(index);<br>		});<br>	});<br>}<br>// 关闭某层以后的所有层<br>function closeDept(dst) {<br>	layui.use([&#39;layer&#39;, &#39;authtree&#39;, &#39;jquery&#39;], function(){<br>		var jquery = layui.jquery;<br>		var layer = layui.layer;<br>		var authtree = layui.authtree;<br><br>		layer.prompt({title: &#39;关闭某层以后的所有层&#39;}, function(value, index, elem) {<br>			authtree.closeDept(dst, value);<br>			layer.close(index);<br>		});<br>	});<br>}<br>// 转换列表<br>function listConvert(url) {<br>	layui.use([&#39;layer&#39;, &#39;authtree&#39;, &#39;jquery&#39;, &#39;form&#39;, &#39;code&#39;], function(){<br>		var jquery = layui.jquery;<br>		var layer = layui.layer;<br>		var authtree = layui.authtree;<br>		var form = layui.form;<br><br>		layer.open({<br>			title: &#39;列表转树演示&#39;<br>			,content: &#39;&lt;fieldset class=&quot;layui-elem-field layui-field-title&quot;&gt;&lt;legend&gt;列表数据转权限树&lt;/legend&gt;&lt;/fieldset&gt;&lt;form class=&quot;layui-form&quot;&gt; &lt;div class=&quot;layui-form-item&quot;&gt; &lt;label class=&quot;layui-form-label&quot;&gt;多选权限&lt;/label&gt; &lt;div class=&quot;layui-input-block&quot;&gt; &lt;div id=&quot;LAY-auth-tree-convert-index&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;layui-form-item&quot;&gt; &lt;div class=&quot;layui-input-block&quot;&gt; &lt;button class=&quot;layui-btn&quot; type=&quot;submit&quot; lay-submit lay-filter=&quot;LAY-auth-tree-submit&quot;&gt;提交&lt;/button&gt; &lt;button class=&quot;layui-btn layui-btn-primary&quot; type=&quot;reset&quot;&gt;重置&lt;/button&gt; &lt;/div&gt; &lt;/div&gt;&lt;/form&gt;&lt;pre class=&quot;layui-code&quot; id=&quot;LAY-auth-tree-convert-code&quot;&gt;&lt;/pre&gt;&#39;<br>			,area: [&#39;800px&#39;, &#39;400px&#39;]<br>			,tipsMore: true<br>			,success: function() {<br>				$.ajax({<br>					url: url,<br>					dataType: &#39;json&#39;,<br>					success: function(res){<br>						$(&#39;#LAY-auth-tree-convert-code&#39;).text(JSON.stringify(res, null, 2));<br>						layui.code({<br>							title: &#39;返回的列表数据&#39;<br>						});<br>						// 支持自定义递归字段、数组权限判断等<br>						// 深坑注意：如果API返回的数据是字符串，那么 startPid 的数据类型也需要是字符串<br>						var trees = authtree.listConvert(res.data.list, {<br>							primaryKey: &#39;alias&#39;<br>							,startPid: &#39;0&#39;<br>							,parentKey: &#39;palias&#39;<br>							,nameKey: &#39;name&#39;<br>							,valueKey: &#39;alias&#39;<br>							,checkedKey: res.data.checkedAlias<br>						});<br>						// 如果页面中多个树共存，需要注意 layfilter 需要不一样<br>						authtree.render(&#39;#LAY-auth-tree-convert-index&#39;, trees, {<br>							inputname: &#39;authids[]&#39;, <br>							layfilter: &#39;lay-check-convert-auth&#39;, <br>							// openall: true,<br>							autowidth: true,<br>						});<br>					}<br>				});<br>			},<br>		});<br>	});<br>}<br>&lt;/script&gt;<br>&lt;!-- 状态模板 --&gt;<br>&lt;script type=&quot;text/html&quot; id=&quot;LAY-auth-tree-nodes&quot;&gt;<br>&lt;style type=&quot;text/css&quot;&gt;<br>	.layui-layer-page .layui-layer-content{<br>		padding: 20px;<br>		line-height: 22px;<br>	}<br>&lt;/style&gt;<br>	&lt;table class=&quot;layui-table&quot;&gt;<br>		&lt;thead&gt;<br>			&lt;th&gt;方法名&lt;/th&gt;<br>			&lt;th&gt;描述&lt;/th&gt;<br>			&lt;th&gt;节点&lt;/th&gt;<br>		&lt;/thead&gt;<br>		&lt;tbody&gt;<br>			{{# layui.each(d.data, function(index, item) { }}<br>			&lt;tr&gt;<br>				&lt;td&gt;{{item.func}}&lt;/td&gt;<br>				&lt;td&gt;{{item.desc}}&lt;/td&gt;<br>				&lt;td&gt;&lt;a class=&quot;LAY-auth-tree-show-detail&quot; href=&quot;javascript:;&quot; data-title=&quot;{{item.desc}}&quot; data-content=&quot;{{item.data.join(&#39;]&lt;br&gt;[&#39;)}}&quot;&gt;查看详情&lt;/a&gt;({{item.data.length}})&lt;/td&gt;<br>			&lt;/tr&gt;<br>			{{# });}}<br>		&lt;/tbody&gt;<br>	&lt;/table&gt;<br>&lt;/script&gt;<br>&lt;/html&gt;</pre>
                        <hr>
                    </div>
                </div>
                <div class="layui-card fly-extend-doc">
                    <div class="layui-card-header">
                        <h3 class="layui-inline layui-this">下载</h3>
                    </div>
                    <div class="layui-card-body detail-body layui-text">
                        <div class="layui-btn-container"> <a href="https://cdn.layui.com/extend/11634672_1563610689226_80251.zip" target="_blank" class="layui-btn layui-btn-lg layui-btn-primary"> 立即下载 </a> <a href="https://gitee.com/wangerzi/layui-authtree"
                                target="_blank" class="layui-btn layui-btn-lg layui-btn-primary layui-border-red"> 去码云下载
                            </a> <a href="https://github.com/wangerzi/layui-authtree" target="_blank" class="layui-btn layui-btn-lg layui-btn-primary layui-border-black"> 去
                                GitHub 下载 </a>
                            <blockquote class="layui-elem-quote"> 该扩展组件由第三方用户主动投递，并由其自身进行维护，本站仅做收集。 </blockquote>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="fly-footer"></div>
    </div>
    <script src="../../layui/dist/layui.js"></script>
    <script>
        layui.cache.page = 'extends';
        layui.cache.user = {
            username: '游客',
            uid: -1,
            avatar: '../static/images/fly/avatar/default.png',
            experience: 0,
            sum: 0,
            vip: 0,
            sex: ''
        };
        layui.config({
            version: "111"
        }).extend({
            'fly': '../static/lay/modules/fly/index'
        }).use('fly');
    </script>
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?d214947968792b839fd669a4decaaffc";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
</body>

</html>